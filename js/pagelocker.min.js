export class PageLocker{sendPageState(){window.GravAdmin.config.route?this.acquireLock():this.removeLock()}async acquireLock(e=0){const o={route:window.GravAdmin.config.route,url:window.GravAdmin.config.current_url,lastTimestamp:e};let t;try{const e=await fetch(window.location.pathname+"/pagelocks:acquireLock",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!e.ok)return this.notifyUser("acquireLock: Unexpected response from server.","error"),void console.log(e);t=await e.json()}catch(e){return this.notifyUser("acquireLock: Unexpected error while accessing the server.","error"),void console.log(e)}t.isLockAcquired?setTimeout(()=>{this.acquireLock(t.lastTimestamp)},1e3*pagelocksConfig.keepAliveInterval):(this.makeInterfaceReadonly(),this.notifyUser(t.alert,"error"))}async removeLock(){try{const e=await fetch(window.location.pathname+"/pagelocks:removeLock",{method:"POST",headers:{"Content-Type":"application/json"}});if(!e.ok)return this.notifyUser("removeLock: Unexpected response from server.","error"),void console.log(e)}catch(e){return this.notifyUser("removeLock: Unexpected error while accessing the server.","error"),void console.log(e)}}makeInterfaceReadonly(){document.querySelectorAll("form#blueprints .tabs-content, #titlebar-button-delete, #titlebar-save, #admin-mode-toggle").forEach(e=>{e.classList.add("locked")})}notifyUser(e,o){const t=document.createElement("div");t.className=o+" alert pagelocks";const r=document.createTextNode(e);t.appendChild(r);const n=document.getElementById("messages");null==n||n.appendChild(t)}}if(window.GravAdmin){(new PageLocker).sendPageState()}